<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>日付自動置換付きプロンプト生成ツール</title>
    <style>
      :root {
        --fg: #1f2328;
        --muted: #6a737d;
        --border: #e5e7eb;
        --bg: #f8fafc;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto,
          "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
        color: var(--fg);
        background: var(--bg);
      }
      .wrap {
        max-width: 820px;
        margin: 40px auto;
        padding: 0 16px;
      }
      header {
        margin-bottom: 16px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 4px;
      }
      p.lead {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
      }
      .card {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
      }
      textarea {
        width: 100%;
        min-height: 260px;
        resize: vertical;
        padding: 12px 14px;
        line-height: 1.6;
        border-radius: 10px;
        border: 1px solid var(--border);
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
          "Noto Sans Mono CJK JP", monospace;
        background: #fff;
      }
      .toolbar {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        flex-wrap: wrap;
      }
      button {
        appearance: none;
        border: 1px solid var(--border);
        background: #111827;
        color: #fff;
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
      }
      button.secondary {
        background: #fff;
        color: #111827;
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .hint {
        margin-top: 8px;
        font-size: 12px;
        color: var(--muted);
      }
      /* toast */
      .toast {
        position: fixed;
        left: 50%;
        bottom: 24px;
        transform: translateX(-50%) translateY(20px);
        background: #111827;
        color: #fff;
        padding: 10px 14px;
        border-radius: 999px;
        opacity: 0;
        pointer-events: none;
        transition: 0.25s ease;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        font-size: 14px;
      }
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --fg: #e5e7eb;
          --muted: #9ca3af;
          --border: #374151;
          --bg: #0b1220;
        }
        .card,
        textarea {
          background: #0f172a;
        }
        button.secondary {
          background: #0f172a;
          color: #e5e7eb;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>プロンプト生成（当日日付を自動挿入）</h1>
        <p class="lead">
          「YYYY/MM/DD
          たべたもの」から始まる定型プロンプトを、東京タイムゾーンの当日で生成します。
        </p>
      </header>

      <div class="card">
        <textarea id="output" readonly></textarea>
        <div class="toolbar">
          <button id="copyBtn">コピー</button>
          <button id="regenBtn" class="secondary" title="手動で再生成">
            再生成
          </button>
        </div>
        <div class="hint">
          ※ 毎分チェックして日付が変われば自動で更新します（Asia/Tokyo）。
        </div>
      </div>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
      (() => {
        const TZ = "Asia/Tokyo";
        const $out = document.getElementById("output");
        const $copy = document.getElementById("copyBtn");
        const $regen = document.getElementById("regenBtn");
        const $toast = document.getElementById("toast");

        function nowTokyo() {
          // 安全に東京の現在日時を生成
          return new Date(new Date().toLocaleString("en-US", { timeZone: TZ }));
        }
        function fmtDateYYYYMMDD(d) {
          const y = d.getFullYear();
          const m = String(d.getMonth() + 1).padStart(2, "0");
          const day = String(d.getDate()).padStart(2, "0");
          return `${y}/${m}/${day}`;
        }
        function buildPrompt() {
          const date = fmtDateYYYYMMDD(nowTokyo());
          return `${date} 
        
たべたもの

1日の基準値
- 総摂取カロリー：1,980 kcal
- P：99 g（396 kcal）
- F：66 g（594 kcal）
- C：247.5 g（990 kcal）
今日食べたものの、基準値に対しての達成率をわかりやすくコードブロックで出して。`;
        }
        function render() {
          $out.value = buildPrompt();
        }
        function showToast(msg) {
          $toast.textContent = msg;
          $toast.classList.add("show");
          clearTimeout(showToast._t);
          showToast._t = setTimeout(
            () => $toast.classList.remove("show"),
            1800
          );
        }

        // 初期描画
        render();

        // コピー
        $copy.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText($out.value);
            showToast("コピーしました");
          } catch {
            // フォールバック
            $out.select();
            document.execCommand("copy");
            showToast("コピーしました");
          }
        });

        // 手動再生成
        $regen.addEventListener("click", render);

        // 1分ごとに日付変化を検知して自動更新（0:00跨ぎ対応）
        setInterval(() => {
          const generated = $out.value;
          const fresh = buildPrompt();
          if (generated !== fresh) $out.value = fresh;
        }, 60 * 1000);
      })();
    </script>
  </body>
</html>
